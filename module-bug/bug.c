#include <linux/init.h>
#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/proc_fs.h>

void (*my_funptr)(void);

/* Kernel 3.9 > mas n funciona
static ssize_t write_proc(struct file *file, const char *buf, size_t len, loff_t *p_off){
	my_funptr();
	return len;
}

struct file_operations proc_fops = {
	.write = write_proc,
};

int exploit_init(void){
	proc_create("write", 0666, NULL, &proc_fops);
	return 0;
}
*/

int write_proc(struct file *file, const char *buf, unsigned long len){
	my_funptr();
	return len;
}

int exploit_init(void){
	create_proc_entry("bug", 0666, 0)->write_proc = write_proc;
	return 0;
}

void proc_cleanup(void) {
    remove_proc_entry("bug",NULL);
}

module_init(exploit_init);
module_exit(proc_cleanup);